# Architecture (minMain)

- **App type:** Single-page HTML5 canvas game (`index.html` + `game.js`); no build step.
- **Config:** `config.js` defines `window.API_URL` (leave empty for offline/localStorage).
- **Offline:** `download.js` prefers `beyond-bell-offline.zip`, falls back to JSZip using the `textFiles`/`binaryFiles` lists. `sw.js` caches the same core assets for hosted/offline revisits.
- **Assets:** `music/` (main_theme.ogg, galactic_rap.ogg), `sfx/` (zap.wav), `jszip.min.js` for client ZIP fallback.
- **Serve locally:** Open `index.html` directly or run a simple static server (e.g., `start_server.ps1` in full project; any static server works here).
- **Audio behavior:** Music is started only once gameplay is active; cutscenes/dev jumps call a central music stop helper and defer restarts until cutscenes/menus close to prevent overlap. Dev level control now hard-stops all music via `devResetMusic` and restarts cleanly through `devStartFreshMusic` to avoid overlapping tracks when jumping levels. `AudioManager` receives dev context (dev flag, allow-start getter, stop-all helper) so its dev-only single-track path is enforced when dev level skip tools run. Music session invalidation is centralized in `AudioManager.bumpMusicSession`, invoked by dev stop helpers.
- **Update flow:** When adding files, update `download.js` lists, align `sw.js` ASSETS, then rebuild `beyond-bell-offline.zip` (run `package_offline.ps1`) so downloads mirror this folder.
- **Visuals:** The Atomic Fighter (basic ship) rendering is leaner (duplicate tail-glow pass removed) and now carries: high-speed dust/ionized wake tied to velocity/boost; wingtip micro-thrusters on heavy strafes; ghost afterimage trails at extreme speed/boost; impact scorch + repair shimmer; low-health canopy dim + wingtip flickers; decel/boost-end venting; weapon-colored muzzle bloom; shield-hit diffraction shimmer; gentle hover dust near screen bottom. Quantum Plasma Flame skin now features a warmer orange/yellow core with a golden helical dust wrap running the full plume. Added "Eclipse Nova Hull" (store hull skin, 1 NK test price, unlocked for testing) with obsidian/wine plating, magenta-gold ribbons, amber canopy/tip, and warm tail glow; compatible with all engine flames. All effects respect particle/quality settings and are suppressed in minimal quality.
- **Performance Optimizations:** Molecule rendering uses health bucket system (5 discrete buckets: 100%, 75%, 50%, 25%, 10%) and gradient caching for bonds and atoms, reducing gradient creation by 60-80%. Particle rendering uses gradient caching for fire, blue, and orange particles by size bucket, reducing gradient creation by 70-85%. Collision spin effect starts fast (no slow motion) and uses progressive speed curve (fast → faster → slow down).
- **Character Rendering:** High-fidelity character rendering system with three-point lighting (key, fill, rim), realistic proportions, detailed features (35 hair strands, 7 hair spikes, 30 mustache hairs, 4 fingers per hand), physics-based animations (breathing, hair movement, blinking), and professional textures (sweater knit patterns, realistic skin tones). Used for Einstein and Bell characters in cutscenes. See `CHARACTERS.md` for detailed character documentation.
- **Cutscenes:** Enhanced tutorial intro cutscene ("Welcome, Pilot!") features realistic deep space background with nebula clouds, quantum energy effects, enhanced starfield, high-fidelity Einstein character (both left side and inside ship), enhanced Einstein ship with animations, and stunning animated text boxes with phase-based positioning and colors. See `GAME_INTRO.md` for complete cutscene documentation.
- **Upgrades:** See `BALANCE_ANALYSIS.md` and `GAME_BALANCE_UPDATES.md` for level-up stat upgrades, balance analysis, and progression systems.
- **Ship visuals detail:** See `SHIP_VISUALS.md` for Atomic Fighter visual enhancements (motion/impact effects, engine flame skins, gating rules, store auto-equip behavior).
- **Damage effects:** See `DAMAGE_EFFECTS.md` for comprehensive documentation of molecule damage (spin/wobble) and bullet damage (lunge) effects, including slow-motion, 3D perspective, stretch/shrink, and enhanced particle systems.
- **Documentation:** Comprehensive documentation is now included in the repository:
  - **Game Development**: `START_HERE.md`, `ARCHITECTURE.md`, `PERFORMANCE_ANALYSIS.md`, `OPTIMIZATION_STATUS.md`, `OPTIMIZATION_OPPORTUNITIES.md`, `PRE_RENDERING_REVIEW.md`
  - **Game Systems**: `BALANCE_ANALYSIS.md`, `GAME_BALANCE_UPDATES.md`, `GAME_STATS_REFERENCE.md`, `STAT_APPLICATION_REVIEW.md`, `CRAFTING_REVIEW.md`
  - **Visual Systems**: `SHIP_VISUALS.md`, `DAMAGE_EFFECTS.md`, `CHARACTERS.md`, `GAME_INTRO.md`, `INTERACTIVE_LOGO.md`
  - **Audio**: `audio_implementation_guide.md`, `audio_resources.md`, `audio_setup.md`, `convert_audio.md`, `readme_audio.md`
  - **Packaging & Deployment**: `OFFLINE_DOWNLOAD.md`, `ELECTRON_PACKAGING.md`, `FULL_GAME_PACKAGE.md`, `DEMO_PACKAGE.md`, `STEAM_PREPARATION.md`, `UPDATING_PACKAGES.md`
  - **Website**: `WEBSITE_DESIGN.md`, `WEBSITE_UPDATES.md`, `NETLIFY_DEPLOYMENT.md`
- **Offline Download:** The download button now includes all documentation files in the ZIP package. All markdown files are included in `download.js` textFiles list and `sw.js` ASSETS cache.

